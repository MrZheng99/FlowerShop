<table id="view_flo_data" data-options="fit:true">
</table>

<div id="view_goods_search">
   <div class="datagrid-btn-separator"></div>
   <label>鲜花类型:</label>
   <select id="view_flo_search_tid">
       <option value=''>--请选择--</option>
   </select> 
   <label>鲜花系列:</label>
   <select id="view_flo_search_sid">
       <option value=''>--请选择--</option>
   </select> 
   <label>鲜花名称:</label>
   <input type="text" placeholder="请输入菜品名称..." id="views_flo_search_fname" />
   <a href="javascript:searchGoodsInfo()" class="easyui-linkbutton" data-options="iconCls:'icon-search'">查询</a>
</div>
<div id="view_goods_dialog" data-options="closed:true">

</div>
<script>
$(function(){
	$.post("/zyl/flowerType/findAll", data=>{
		var str="";
		$.each(data.data, function(index, item) {
			str +="<option value='" + item.tid + "'>" + item.tname + "</option>";
		})
		$("#view_flo_search_tid").append($(str));
	}, "json");
	
	$.post("/zyl/flowerSeries/findAll", data=>{
		var str="";
		$.each(data.data, function(index, item) {
			str +="<option value='" + item.sid + "'>" + item.sname + "</option>";
		})
		$("#view_flo_search_sid").append($(str));
	}, "json");
})


var view_goods_obj;
var statusObj = [{fno:0, fname:"不可用"}, {fno:1, fname:"可用"}];


var view_goods_obj = $('#view_flo_data').datagrid({
	url:'/zyl/flower/findAll',
	method:"get",
	fitColumns: true,
	loadMsg: '数据加载中，请稍后...',
	striped: true,
	remoteSort: false,
	singleSelct: true,
	pagination: true,
	rownumbers: true,
	pageSize: 10,
	pageList: [10, 15, 20, 30, 40, 50, 100],
	loadFilter:function(data){
		info["total"]= data.data.length;
		info["rows"]= data.data;
		return info;
	},
	columns:[[
		{field:'fid',title:'鲜花编号',width:50,align:'center'},
		{field:'fname', title:'鲜花名称',width:100,align:'center'},
		{field:'type.tname', title:'所属类型',width:50,align:'center',formatter: function(value,row,index){
				return row.type.tname;
		    }
        },
		{field:'seris.name', title:'所属系列',width:50,align:'center',formatter: function(value,row,index){
			return row.series.sname;
	    }
    },
		{field:'price', title:'单价',width:50,align:'center'},
		{field:'deliveryDesc', title:'配送说明',width:100,align:'center'},
		{field:'status',title:'类型状态',width:50,align:'center', formatter:function(val, row, index){
			if(val == 0){
				return "不可用";
			} else{
				return "可用";
			}
		}, editor:{type: "combobox", options:{required: true,  valueField:"tno", textField:"tname", data:statusObj}}}
	]],
	toolbar: "#view_goods_search"
});


function searchGoodsInfo(){
	var tid= $.trim($("#view_flo_search_tid").val());
	var sid= $.trim($("#view_flo_search_sid").val());
	var fname = $.trim($("#views_flo_search_fname").val());
	
	view_goods_obj.datagrid({
		   loader : function(flower, success, error) {
               $.ajax({
                   type : "post",
                   url : "/zyl/flower/find",
                   dataType : 'json',
                   contentType : 'application/json;charset=utf-8', // 设置请求头信息
                   data : JSON.stringify({tid:tid,sid:sid,fname:fname}),
                   success : function(data) {       
                             success(data);           
                   }
               });
           }

	})
}
</script>