<table id="order_data" data-options="fit:true"></table>

<a href="javascript:openAddTypesDialog()" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" style="float:left">添加</a>

<div id="view_goods_dialog" data-options="closed:true">
</div>
<script>
var statusObj = [{tno:0, tname:"冻结"}, {tno:1, tname:"恢复"}];
var flagObj = [{fno:2, fname:"发货"}];
var order_editRow = undefined;
var order_op;
var order_flag;

var order_obj = $('#order_data').datagrid({
	url:'/zyl/order/findAll',
	method:"get",
    fitColumns: true,
	loadMsg: '数据加载中，请稍后...',
	striped: true,
	remoteSort: false,
	singleSelect: true,
	loadFilter:function(data){
		info["total"]= data.data.length;
		info["rows"]= data.data;
		return info;
	},
	columns:[[
		{field:'oid',title:'订单编号',width:50,align:'center'},
		{field:'createDate',title:'下单日期',width:40,align:'center'},
		{field:'payDate',title:'付款日期',width:40,align:'center'},
		{field:'sendDate',title:'发货日期',width:40,align:'center'},
		{field:'receiveDate',title:'收货日期',width:40,align:'center'},
		{field:'amount',title:'订单总额',width:20,align:'center'},
		{field:'address',title:'地址',width:60,align:'center'},
		{field:'receivePerson',title:'收货人',width:25,align:'center'},
		{field:'tel',title:'联系电话',width:40,align:'center'},
		{field:'flag',title:'订单状态',width:20,align:'center', formatter:function(val, row, index){
			if(val == 0){
				return "未付款";
			} else if(val == 1){
				return "已付款";
			}else if(val == 2){
				return "已发货";
			}else if(val == 3){
				return "已收货";
			}
		}, editor:{type: "combobox", options:{required: true,  valueField:"fno", textField:"fname", data:flagObj}}},
		{field:'status',title:'状态',width:20,align:'center', formatter:function(val, row, index){
			if(val == 0){
				return "已冻结";
			} else{
				return "正常";
			}
		}, editor:{type: "combobox", options:{required: true,  valueField:"tno", textField:"tname", data:statusObj}}}
	]],
		toolbar:[{
			text: "编辑",
			iconCls: 'icon-edit',
			handler: function(){
				order_flag = "修改";
						     
				if(order_editRow != undefined){
					return;
				}
				
				var row = order_obj.datagrid("getSelected");
				if( row == null){
					$.messager.show({title:'温馨提示',msg: '请选择您要修改的商品类型信息...', timeout:2000, showType:'slide'});
					return;
				}
				
				order_editRow = order_obj.datagrid("getRowIndex", row);
				
				order_obj.datagrid("beginEdit", order_editRow);
			}
		},'-',{
			text:"撤销",
			iconCls:'icon-undo',
			handler:function(){
				row = null;
				order_obj.datagrid("rejectChanges");
				order_editRow = undefined;
			}
		},'-',{
			text:"保存",
			iconCls:  'icon-save',
			handler: function(){
				if(order_editRow == undefined){
					return;
				}
				
				order_obj.datagrid("endEdit", order_editRow);
				
				if(order_obj.datagrid("getChanges")[0] == null){
					row = null;
					order_editRow = undefined;
					return;
				}
				
				var row = order_obj.datagrid("getChanges")[0];
				
				var status = row.status;
				var oid = row.oid;
				var flag = row.flag;
												
				$.ajax({
					url:"/zyl/order/updateFlag",
					type:"post",
					data:JSON.stringify({status:status,flag:flag,oid:oid}),
					contentType:"application/json",
					dataType:"json",
					success:function(data){
						if(data.success){
							$.messager.show({title:'成功提示',msg: '订单信息修改成功...', timeout:2000, showType:'slide'});
							$('#order_data').datagrid('loadData');
						}else{
							$.messager.show('失败提示',  '信息修改失败...', 'error');
							$('#order_data').datagrid('reload');
						}
					}
				});
				row = null;
				order_editRow = undefined;
			}
		},'-',{text: '订单状态:<select id="flag"><option value="0">未付款</option><option value="1">已付款</option><option value="2">已发货</option><option value="3">已收货</option></select>'
        }, 
		{
		text: "查找",
		iconCls: 'icon-search',
		handler: function(){
			var flag = $("#flag").val();
			
		    if (flag == null || flag == ""){
				$.messager.show({title:'温馨提示',msg: '请选择订单状态...', timeout:2000, showType:'slide'});
		    	return;
		    }
		 order_obj.datagrid({
			   loader : function(flower, success, error) {    
				    $.ajax({
				    	url:"/zyl/order/findByFlag",
				    	type:"post",
				    	data:JSON.stringify({flag:flag}),
				    	contentType : 'application/json;charset=utf-8',
				    	success:function(data){
				    		success(data);
				    	}
				    })
	           }

		})
		}
	}]
});
</script>
