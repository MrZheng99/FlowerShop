<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zyl.flowershop.dao.IOrderDao">
	<select id="findCurrent" resultType="Order">
		select
		createDate,payDate,sendDate, receiveDate, amount, address,tel, flag
		from tb_order where oid=#{oid} and `uid`= #{uid} and status=1;
	</select>
	<select id="findAll" resultType="Order">
		select
		createDate,payDate,sendDate, receiveDate, amount, address,tel, flag
		from tb_order where status=1;
	</select>
	<!-- 每日订单总额 -->
	<select id="findByDate" resultType="Order">
		select
		DATE_FORMAT(odate,'%Y-%m-%d') as createDate, sum(amount) as amount
		from
		tb_order group by DATE_FORMAT(odate,'%Y-%m-%d')
	</select>
	<select id="findByFlag" resultType="Order">
		select
		createDate,payDate,sendDate, receiveDate, amount, address,tel as
		amount from
		tb_order where flag=#{flag};
	</select>
	<insert id="insert" parameterType="Order" flushCache="true">
		insert into
		tb_order (`odate`,`amount`,`aid`,`flag`,`status`)
		values (#{odate},
		#{amount}, #{aid}, 0, 1);
	</insert>
	<!-- 更新订单表状态和时间 -->
	<update id="updateFlag" parameterType="Order" flushCache="true">
		update tb_order
		<set>
			<if test="receiveDate != null and receiveDate !='' ">
				`receiveDate`=#{receiveDate},
			</if>
			<if test="sendDate != null and sendDate !='' ">
				`sendDate`=#{sendDate},
			</if>
			<if test="payDate != null and payDate !='' ">
				`payDate`=#{payDate},
			</if>
			<if test="flag != null and flag !='' ">
				`flag`=#{flag},
			</if>
		</set>
		where `oid`=#{oid}
	</update>
	<!--更新地址和电话 -->
	<update id="updateAddrTel" parameterType="Order"
		flushCache="true">
		update tb_order set
		`address`=#{address},`tel`=#{tel}
		where
		`oid`=#{oid}
	</update>

</mapper>